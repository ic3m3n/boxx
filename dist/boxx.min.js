/*!
boxx
@version 0.0.0
@date 2015-02-09, 10:30
*/
!function(a){"use strict";function b(a,b){for(var c in b)a=a.replace(new RegExp("{"+c+"}","g"),b[c]);return a}var c=function(a,b){this.key={backspace:8,tab:9,enter:13,escape:27,space:32,left:37,up:38,right:39,down:40,comma:188},this.removeActive=!1,this.dropdownActive=!1,this.dropdownIndex=-1,this.element=a,this.options=b,this.container=document.createElement("div"),this.inputBoxx=document.createElement("input"),this.dropdown=document.createElement("ul"),this.tagTpl='<div class="'+this.options.prefix+this.options.stylers.tag+'"><span class="'+this.options.prefix+this.options.stylers.tagLabel+'">{label}</span><span class="'+this.options.prefix+this.options.stylers.tagClose+'">x</span></div>',this.listItemTpl='<li id="{id}" class="'+this.options.prefix+this.options.stylers.dropdownItem+'">{value}</li>',this.init()};c.prototype.init=function(){this.createContainer(function(){this.bind(),this.options.enableDropdown&&""!==this.options.collection&&this.createDropdown()}.bind(this))},c.prototype.createContainer=function(b){a(this.container).css({width:a(this.element).css("width"),position:"relative"}),a(this.container).attr("id",this.options.prefix+a(this.element).attr("id")),a(this.container).addClass(this.options.prefix+this.options.stylers.container),a(this.element).after(a(this.container)),a(this.element).hide(),this.createInput(),b()},c.prototype.createInput=function(){a(this.inputBoxx).addClass(this.options.prefix+this.options.stylers.input),a(this.inputBoxx).attr("placeholder","type something and hit enter"),a(this.container).append(a(this.inputBoxx)),this.renderTags()},c.prototype.createDropdown=function(){a(this.dropdown).css({width:a(this.container).css("width"),position:"absolute",left:"50%",transform:"translateX(-50%)"}),a(this.dropdown).addClass(this.options.prefix+this.options.stylers.dropdown),a(this.container).after(a(this.dropdown)),this.renderDropdown(),this.hideDropdown()},c.prototype.bind=function(){this.bindClicks(),this.bindEvents(),this.bindKeys()},c.prototype.bindClicks=function(){a(this.container).on("click",function(){a(this.inputBoxx).focus(),this.options.openDropdownOnClick&&this.showDropdown()}.bind(this)),a(this.dropdown).on("click","li",function(b){this.addTag(a(b.currentTarget).text())}.bind(this))},c.prototype.bindEvents=function(){a(document).on("tag:changed",function(){this.renderDropdown(),this.renderTags(),this.dropdownIndex=-1,this.removeActive=!1}.bind(this)),this.options.tagOn.blur&&(a(this.inputBoxx).bind("blur"),a(this.inputBoxx).on("blur",function(){this.addTag(a(this.inputBoxx).val().toLowerCase())}.bind(this)))},c.prototype.bindKeys=function(){a(this.inputBoxx).on("keyup",function(b){b.stopPropagation();var c=b.keyCode||b.which;switch(c){case this.key.enter:this.options.tagOn.enter&&(b.preventDefault(),this.addTag(this.options.enableDropdown?void 0!==a("#"+this.dropdownIndex).attr("id")?a("#"+this.dropdownIndex).text():a(this.inputBoxx).val().toLowerCase():a(this.inputBoxx).val().toLowerCase()));break;case this.key.comma:b.preventDefault(),this.addTag(a(this.inputBoxx).val().toLowerCase());break;case this.key.tab:this.options.tagOn.tab&&(b.preventDefault(),this.addTag(a(this.inputBoxx).val().toLowerCase()));break;case this.key.escape:this.options.enableDropdown&&this.hideDropdown(),a(this.inputBoxx).val("");break;case this.key.up:this.slide(--this.dropdownIndex);break;case this.key.down:this.slide(++this.dropdownIndex);break;default:this.options.enableAutocomplete&&this.renderDropdown(),this.options.openDropdownOnType&&this.showDropdown()}}.bind(this)),a(this.inputBoxx).on("keydown",function(b){b.stopPropagation();var c=b.keyCode||b.which;switch(c){case this.key.space:this.options.tagOn.space&&(b.preventDefault(),this.addTag(this.options.enableDropdown?void 0!==a("#"+this.dropdownIndex).attr("id")?a("#"+this.dropdownIndex).text():a(this.inputBoxx).val().toLowerCase():a(this.inputBoxx).val().toLowerCase()));break;case this.key.backspace:""===a(this.inputBoxx).val()?this.removeActive?this.removeTag(a(this.container).children("."+this.options.prefix+this.options.stylers.tag).last()):(this.removeActive=!0,a(this.container).children("."+this.options.prefix+this.options.stylers.tag).last().addClass(this.options.prefix+this.options.stylers.tagActive)):(this.removeActive=!1,this.renderDropdown());break;default:a(this.container).children("."+this.options.prefix+this.options.stylers.tag).removeClass(this.options.prefix+this.options.stylers.tagActive)}}.bind(this))},c.prototype.addTag=function(b){""!==b&&(this.hasTag(b)||(a(this.element).val(a(this.element).val()+(""!==a(this.element).val()?",":"")+b),a(document).trigger("tag:changed"),a(document).trigger(this.options.events.created)),a(this.inputBoxx).val(""))},c.prototype.removeTag=function(b){if(""!==a(this.element).val()){var c=b.children("."+this.options.prefix+this.options.stylers.tagLabel).text(),d=a(this.element).val().split(","),e=[];a.each(d,function(a,b){b!==c&&""!==b&&e.push(b)}),this.removeActive=!1,a(this.element).val(e.join(",")),a(document).trigger("tag:changed"),a(document).trigger(this.options.events.removed)}},c.prototype.hasTag=function(b){var c=a(this.element).val().split(","),d=!1;return a.each(c,function(c,e){a.trim(e)===a.trim(b)&&(d=!0)}),d},c.prototype.renderTags=function(){a("."+this.options.prefix+this.options.stylers.tag).remove();var c="";""!==a(this.element).val()&&(a.each(a(this.element).val().split(","),function(d,e){c=e,a(this.inputBoxx).before(b(this.tagTpl,{label:e}))}.bind(this)),a("."+this.options.prefix+this.options.stylers.tag).on("click","."+this.options.prefix+this.options.stylers.tagClose,function(b){this.removeTag(a(b.currentTarget).closest("div"))}.bind(this)),this.options.enableFilterEvent&&a("."+this.options.prefix+this.options.stylers.tag).on("click","."+this.options.prefix+this.options.stylers.tagLabel,function(b){a(document).trigger(this.options.events.filter,a(b.currentTarget).text())}.bind(this)))},c.prototype.renderDropdown=function(){this.options.enableDropdown&&(a(this.dropdown).children("li").remove(),a.each(this.filterDropdown(),function(c,d){a(this.dropdown).append(b(this.listItemTpl,{value:d,id:c}))}.bind(this)))},c.prototype.filterDropdown=function(){var b=[],c=0;return a.each(this.options.collection,function(d,e){c=0,""!==a(this.inputBoxx).val()&&a(this.inputBoxx).val().length>=this.options.openDropdownThreshold?e.indexOf(a(this.inputBoxx).val())>=0&&a.each(a(this.element).val().split(","),function(a,b){e!==b&&c++}):a.each(a(this.element).val().split(","),function(a,b){e!==b&&c++}),c==a(this.element).val().split(",").length&&b.push(e)}.bind(this)),b},c.prototype.showDropdown=function(){this.options.enableDropdown&&(a(this.dropdown).show(),a(this.dropdown).addClass(this.options.prefix+this.options.stylers.dropdownActive),this.dropdownActive=!0)},c.prototype.hideDropdown=function(){this.options.enableDropdown&&(a(this.dropdown).hide(),a(this.dropdown).removeClass(this.options.prefix+this.options.stylers.dropdownActive),this.dropdownActive=!1)},c.prototype.slide=function(b){if(0>b)this.dropdownIndex=0;else{if(b>a(this.dropdown).children("li").last().attr("id"))return this.dropdownIndex=a(this.dropdown).children("li").last().attr("id"),!1;a(this.dropdown).children("li").removeClass(this.options.prefix+this.options.stylers.dropdownItemActive),a("#"+b).addClass(this.options.prefix+this.options.stylers.dropdownItemActive),this.options.enableFilterEvent&&a(document).trigger(this.options.events.filter,a("#"+b).text())}},c.prototype.refresh=function(a){this.options.collection=a,this.renderDropdown()},c.prototype.destroy=function(){a(this.container).remove(),a(this.dropdown).remove(),a(this.element).show()},a.fn.boxx=function(b){var d={collection:["rot","gr√ºn","gelb","blau"],prefix:"",stylers:{container:"boxx",tag:"tag",tagActive:"tag--active",tagLabel:"tag__label",tagClose:"tag__close",input:"inputboxx",dropdown:"list",dropdownActive:"list--active",dropdownItem:"list__item",dropdownItemActive:"list__item--active"},threshold:1,tagOn:{space:!0,enter:!0,tab:!0,blur:!1},enableAutocomplete:!0,enableDropdown:!0,openDropdownOnType:!0,openDropdownOnClick:!0,openDropdownThreshold:0,enableFilterEvent:!0,events:{created:"boxx:tag_created",removed:"boxx:tag_removed",filter:"boxx:filter"}},e=a.extend({},d,b),f=void 0!==arguments[0]?arguments:[{}];return this.each(function(){if("object"==typeof f[0]){var b=new c(a(this),e);a(this).data("boxx",b)}else"refresh"==f[0]?a(this).data("boxx").refresh(f[1]):"destroy"==f[0]?a(this).data("boxx").destroy():a.error("Method "+f[0]+" does not exist in $.boxx")})}}(jQuery);